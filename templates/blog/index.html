{% extends "base.html" %}
{% block css_extra%}
<link rel="stylesheet" type="text/css" href="{% asset 'blog.css' %}">
{% endblock %}
{% block body %}
<div class="main">
    <div class="tag-list-wrapper">
        <div class="tag-list-container">
            <ul class="tag-list">
                {% for tag in tags %}
                <li class="tag-list__item">
                    <span class="tag-list__link">{{ tag.name }}</span>
                </li>
                {% endfor %}
            </ul>
        </div>
    </div>
    <div class="feed">
        {% for article in articles %}
        <article class="feed__post">
            <div class="post-card">
                <a href="{% url 'article_details', article %}">
                    <div class="post-card__feature-image"
                        style="background-image:url({% asset 'images/' %}{{ article.cover[0].name }})">
                    </div>
                </a>
                <header class="post-card__header">
                    <div class="post-card__meta">
                        <span class="post-card__tag">
                            {% for tag in article.tags %}
                            <a href="{% url 'tags', tag %}" class="_tag"> {{ tag.name }} </a>
                            {% endfor %}
                        </span>
                        <span class="post-card__date">{{ article.published }}</span>
                    </div>
                    <h2 class="post-card__title">
                        <a href="{% url 'article_details', article %}"> {{ article.title }} </a>
                    </h2>
                </header>
                <a href="{% url 'article_details', article %}">
                    <section class="post-card__excerpt">
                        {{ article.excerpt }}
                    </section>
                    <footer class="post-card__footer">
                        <img src="{% asset 'favicon/android-chrome-512x512.png' %}" class="post-card__profile-image"
                            alt="{{ article.author }}">
                        {{ article.author }}
                    </footer>
                </a>
            </div>
        </article>
        {% else %}
        <div>
            <p>Articles will appear</p>
        </div>
        {% endfor %}
    </div>
    <div class="empty text-center"> </div>
</div>
<script>
    const feed = document.querySelector(".feed");
    let posts = document.getElementsByClassName("feed__post");
    const empty = document.querySelector(".empty");
    let tag_list = document.querySelector(".tag-list");
    tag_list.addEventListener("click", function (e) {
        if (e.target && e.target.matches(".tag-list__link")) {
            let tag_name = e.target.innerHTML;
            if (filterSelection(tag_name)) {
                empty.style.display = "none";
                feed.style.display = "grid";
            } else {
                feed.style.display = "none";
                empty.style.display = "block";
                empty.innerHTML = '<p> <strong>' + tag_name + '</strong > articles will appear here.</p> ';
            };
        }
    });
    function filterSelection(name) {
        let hide_empty_flag = false;
        for (let index = 0; index < posts.length; index++) {
            let post = posts[index];
            let post_tags = post.querySelectorAll(".post-card__tag ._tag");
            // determining to show post or not depending on tag
            for (let i = 0; i < post_tags.length; i++) {
                let tag = post_tags[i].innerHTML.trim();
                if (tag.includes(name)) {
                    post.style.display = "block";
                    hide_empty_flag = true;
                    break;
                } else {
                    post.style.display = "none";
                }
            }

        }
        return hide_empty_flag;
    }

</script>
{% endblock %}